{"version":3,"file":"index-qh_JdJUU.js","sources":["../../src/pages/executions/ExecutionsPage.tsx"],"sourcesContent":["import { useEffect, useState, useMemo } from 'react'\n\nimport { Link, Outlet, useLocation } from 'react-router-dom'\n\nimport { Add as AddIcon, Delete as DeleteIcon } from '@mui/icons-material'\nimport {\n  Container,\n  Typography,\n  Box,\n  Button,\n  Stack,\n  Chip,\n  CircularProgress,\n  Alert,\n  Paper,\n  Divider,\n  IconButton,\n} from '@mui/material'\n\nimport { renderUnit } from '@/utils/unit-utils'\n\nimport { getTrainingExecutions, deleteTrainingExecution } from '../../api/trainingExecutions'\nimport { formatDuration } from '../../hooks/useTimer'\nimport { routes } from '../../routes'\nimport type { TrainingExecutionWithPlan } from '../../types/database'\n\ninterface DailyGroup {\n  dateKey: string\n  dateLabel: string\n  executions: TrainingExecutionWithPlan[]\n  totalDuration: number\n  totalUnits: Map<string, number> // unit_name -> count\n}\n\nfunction groupExecutionsByDay(executions: TrainingExecutionWithPlan[]): DailyGroup[] {\n  const groups = new Map<string, DailyGroup>()\n\n  for (const execution of executions) {\n    const date = new Date(execution.completed_at)\n    // Use local date for grouping (YYYY-MM-DD in local timezone)\n    const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\n\n    if (!groups.has(dateKey)) {\n      groups.set(dateKey, {\n        dateKey,\n        dateLabel: date.toLocaleDateString('ko-KR', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n          weekday: 'short',\n        }),\n        executions: [],\n        totalDuration: 0,\n        totalUnits: new Map(),\n      })\n    }\n\n    const group = groups.get(dateKey)!\n    group.executions.push(execution)\n    group.totalDuration += execution.duration_seconds\n\n    const unitName = renderUnit(execution.training_plans.unit_name)\n    group.totalUnits.set(unitName, (group.totalUnits.get(unitName) || 0) + execution.unit_count)\n  }\n\n  // Sort by date descending\n  return Array.from(groups.values()).sort((a, b) => b.dateKey.localeCompare(a.dateKey))\n}\n\nexport function ExecutionsPage() {\n  const location = useLocation()\n  const isListView = location.pathname === '/executions' || location.pathname === '/executions/'\n\n  return (\n    <Container maxWidth=\"md\">\n      <Box sx={{ my: 4 }}>\n        <Box\n          sx={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            mb: 3,\n          }}\n        >\n          <Box></Box>\n          {/* <Typography variant=\"h4\" component=\"h1\">\n            ÌõàÎ†® ÏàòÌñâ\n          </Typography> */}\n          {isListView && (\n            <Button\n              component={Link}\n              to={routes.executions.new.$()}\n              variant=\"contained\"\n              startIcon={<AddIcon />}\n            >\n              ÏÉà ÌõàÎ†®\n            </Button>\n          )}\n        </Box>\n        {isListView ? <ExecutionsList /> : <Outlet />}\n      </Box>\n    </Container>\n  )\n}\n\nfunction ExecutionsList() {\n  const [executions, setExecutions] = useState<TrainingExecutionWithPlan[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const dailyGroups = useMemo(() => groupExecutionsByDay(executions), [executions])\n\n  useEffect(() => {\n    loadExecutions()\n  }, [])\n\n  async function loadExecutions() {\n    try {\n      setLoading(true)\n      const data = await getTrainingExecutions()\n      setExecutions(data)\n    } catch (err) {\n      setError('ÌõàÎ†® Í∏∞Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.')\n      // eslint-disable-next-line no-console\n      console.error(err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', py: 4 }}>\n        <CircularProgress />\n      </Box>\n    )\n  }\n\n  if (error) {\n    return <Alert severity=\"error\">{error}</Alert>\n  }\n\n  if (executions.length === 0) {\n    return <Alert severity=\"info\">ÏïÑÏßÅ ÌõàÎ†® Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§. ÌõàÎ†®ÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!</Alert>\n  }\n\n  async function handleDelete(id: number) {\n    if (!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return\n    try {\n      await deleteTrainingExecution(id)\n      setExecutions((prev) => prev.filter((e) => e.id !== id))\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err)\n      alert('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.')\n    }\n  }\n\n  return (\n    <Stack spacing={3}>\n      {dailyGroups.map((group) => (\n        <DailyGroupCard key={group.dateKey} group={group} onDelete={handleDelete} />\n      ))}\n    </Stack>\n  )\n}\n\nfunction DailyGroupCard({\n  group,\n  onDelete,\n}: {\n  group: DailyGroup\n  onDelete: (id: number) => void\n}) {\n  const unitsSummary = Array.from(group.totalUnits.entries())\n    .map(([unit, count]) => `${count} ${unit}`)\n    .join(', ')\n\n  return (\n    <Paper elevation={2} sx={{ overflow: 'hidden' }}>\n      {/* Daily Summary Header */}\n      <Box\n        sx={{\n          p: 2,\n          bgcolor: (theme) => (theme.palette.mode === 'dark' ? 'grey.800' : 'grey.100'),\n        }}\n      >\n        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <Typography variant=\"subtitle1\" fontWeight=\"bold\">\n            üìÖ {group.dateLabel}\n          </Typography>\n          <Chip\n            label={`${group.executions.length}Ìöå ÌõàÎ†®`}\n            size=\"small\"\n            color=\"primary\"\n            // variant=\"outlined\"\n          />\n        </Box>\n        <Stack direction=\"row\" spacing={2} sx={{ mt: 1 }}>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            Ï¥ù ÏãúÍ∞Ñ: <strong>{formatDuration(group.totalDuration)}</strong>\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            ÏàòÌñâÎüâ: <strong>{unitsSummary}</strong>\n          </Typography>\n        </Stack>\n      </Box>\n\n      <Divider />\n\n      {/* Execution List */}\n      <Stack divider={<Divider />}>\n        {group.executions.map((execution) => (\n          <ExecutionCard key={execution.id} execution={execution} onDelete={onDelete} />\n        ))}\n      </Stack>\n    </Paper>\n  )\n}\n\nfunction ExecutionCard({\n  execution,\n  onDelete,\n}: {\n  execution: TrainingExecutionWithPlan\n  onDelete: (id: number) => void\n}) {\n  const plan = execution.training_plans\n  const completedDate = new Date(execution.completed_at)\n  const timeStr = completedDate.toLocaleTimeString('ko-KR', {\n    hour: '2-digit',\n    minute: '2-digit',\n  })\n\n  function handleDelete(e: React.MouseEvent) {\n    e.preventDefault()\n    e.stopPropagation()\n    onDelete(execution.id)\n  }\n\n  return (\n    <Box\n      component={Link}\n      to={routes.executions.detail.$path({ id: execution.id }, {})}\n      sx={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        p: 2,\n        textDecoration: 'none',\n        color: 'inherit',\n        '&:hover': {\n          bgcolor: (theme) => (theme.palette.mode === 'dark' ? 'grey.800' : 'grey.50'),\n        },\n      }}\n    >\n      <Box>\n        <Typography variant=\"body1\" fontWeight=\"medium\">\n          {plan.name}\n        </Typography>\n        <Typography variant=\"caption\" color=\"text.secondary\">\n          {timeStr} ‚Ä¢ {formatDuration(execution.duration_seconds)}\n        </Typography>\n      </Box>\n      <Stack direction=\"row\" spacing={1} alignItems=\"center\">\n        <Chip\n          label={`${execution.unit_count} ${renderUnit(plan.unit_name)}`}\n          size=\"small\"\n          color=\"primary\"\n        />\n        <IconButton\n          size=\"small\"\n          onClick={handleDelete}\n          sx={{\n            color: 'text.secondary',\n            '&:hover': { color: 'error.main' },\n          }}\n        >\n          <DeleteIcon fontSize=\"small\" />\n        </IconButton>\n      </Stack>\n    </Box>\n  )\n}\n"],"names":["jsx","jsxs","useState","useMemo","useEffect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAkCA,SAAS,qBAAqB,YAAuD;AACnF,QAAM,6BAAa,IAAA;AAEnB,aAAW,aAAa,YAAY;AAClC,UAAM,OAAO,IAAI,KAAK,UAAU,YAAY;AAE5C,UAAM,UAAU,GAAG,KAAK,YAAA,CAAa,IAAI,OAAO,KAAK,SAAA,IAAa,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,QAAA,CAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAEhI,QAAI,CAAC,OAAO,IAAI,OAAO,GAAG;AACxB,aAAO,IAAI,SAAS;AAAA,QAClB;AAAA,QACA,WAAW,KAAK,mBAAmB,SAAS;AAAA,UAC1C,MAAM;AAAA,UACN,OAAO;AAAA,UACP,KAAK;AAAA,UACL,SAAS;AAAA,QAAA,CACV;AAAA,QACD,YAAY,CAAA;AAAA,QACZ,eAAe;AAAA,QACf,gCAAgB,IAAA;AAAA,MAAI,CACrB;AAAA,IACH;AAEA,UAAM,QAAQ,OAAO,IAAI,OAAO;AAChC,UAAM,WAAW,KAAK,SAAS;AAC/B,UAAM,iBAAiB,UAAU;AAEjC,UAAM,WAAW,WAAW,UAAU,eAAe,SAAS;AAC9D,UAAM,WAAW,IAAI,WAAW,MAAM,WAAW,IAAI,QAAQ,KAAK,KAAK,UAAU,UAAU;AAAA,EAC7F;AAGA,SAAO,MAAM,KAAK,OAAO,OAAA,CAAQ,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,cAAc,EAAE,OAAO,CAAC;AACtF;AAEO,SAAS,iBAAiB;AAC/B,QAAM,WAAW,YAAA;AACjB,QAAM,aAAa,SAAS,aAAa,iBAAiB,SAAS,aAAa;AAEhF,SACEA,kCAAAA,IAAC,WAAA,EAAU,UAAS,MAClB,UAAAC,kCAAAA,KAAC,OAAI,IAAI,EAAE,IAAI,EAAA,GACb,UAAA;AAAA,IAAAA,kCAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI;AAAA,UACF,SAAS;AAAA,UACT,gBAAgB;AAAA,UAChB,YAAY;AAAA,UACZ,IAAI;AAAA,QAAA;AAAA,QAGN,UAAA;AAAA,UAAAD,kCAAAA,IAAC,KAAA,EAAI;AAAA,UAIJ,cACCA,kCAAAA;AAAAA,YAAC;AAAA,YAAA;AAAA,cACC,WAAW;AAAA,cACX,IAAI,OAAO,WAAW,IAAI,EAAA;AAAA,cAC1B,SAAQ;AAAA,cACR,iDAAY,SAAA,EAAQ;AAAA,cACrB,UAAA;AAAA,YAAA;AAAA,UAAA;AAAA,QAED;AAAA,MAAA;AAAA,IAAA;AAAA,IAGH,aAAaA,kCAAAA,IAAC,gBAAA,CAAA,CAAe,0CAAM,QAAA,CAAA,CAAO;AAAA,EAAA,EAAA,CAC7C,EAAA,CACF;AAEJ;AAEA,SAAS,iBAAiB;AACxB,QAAM,CAAC,YAAY,aAAa,IAAIE,aAAAA,SAAsC,CAAA,CAAE;AAC5E,QAAM,CAAC,SAAS,UAAU,IAAIA,aAAAA,SAAS,IAAI;AAC3C,QAAM,CAAC,OAAO,QAAQ,IAAIA,aAAAA,SAAwB,IAAI;AAEtD,QAAM,cAAcC,aAAAA,QAAQ,MAAM,qBAAqB,UAAU,GAAG,CAAC,UAAU,CAAC;AAEhFC,eAAAA,UAAU,MAAM;AACd,mBAAA;AAAA,EACF,GAAG,CAAA,CAAE;AAEL,iBAAe,iBAAiB;AAC9B,QAAI;AACF,iBAAW,IAAI;AACf,YAAM,OAAO,MAAM,sBAAA;AACnB,oBAAc,IAAI;AAAA,IACpB,SAAS,KAAK;AACZ,eAAS,sBAAsB;AAE/B,cAAQ,MAAM,GAAG;AAAA,IACnB,UAAA;AACE,iBAAW,KAAK;AAAA,IAClB;AAAA,EACF;AAEA,MAAI,SAAS;AACX,WACEJ,kCAAAA,IAAC,KAAA,EAAI,IAAI,EAAE,SAAS,QAAQ,gBAAgB,UAAU,IAAI,EAAA,GACxD,UAAAA,kCAAAA,IAAC,oBAAiB,GACpB;AAAA,EAEJ;AAEA,MAAI,OAAO;AACT,WAAOA,kCAAAA,IAAC,OAAA,EAAM,UAAS,SAAS,UAAA,OAAM;AAAA,EACxC;AAEA,MAAI,WAAW,WAAW,GAAG;AAC3B,WAAOA,kCAAAA,IAAC,OAAA,EAAM,UAAS,QAAO,UAAA,+BAA2B;AAAA,EAC3D;AAEA,iBAAe,aAAa,IAAY;AACtC,QAAI,CAAC,QAAQ,cAAc,EAAG;AAC9B,QAAI;AACF,YAAM,wBAAwB,EAAE;AAChC,oBAAc,CAAC,SAAS,KAAK,OAAO,CAAC,MAAM,EAAE,OAAO,EAAE,CAAC;AAAA,IACzD,SAAS,KAAK;AAEZ,cAAQ,MAAM,GAAG;AACjB,YAAM,aAAa;AAAA,IACrB;AAAA,EACF;AAEA,+CACG,OAAA,EAAM,SAAS,GACb,UAAA,YAAY,IAAI,CAAC,UAChBA,kCAAAA,IAAC,gBAAA,EAAmC,OAAc,UAAU,aAAA,GAAvC,MAAM,OAA+C,CAC3E,GACH;AAEJ;AAEA,SAAS,eAAe;AAAA,EACtB;AAAA,EACA;AACF,GAGG;AACD,QAAM,eAAe,MAAM,KAAK,MAAM,WAAW,QAAA,CAAS,EACvD,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,GAAG,KAAK,IAAI,IAAI,EAAE,EACzC,KAAK,IAAI;AAEZ,SACEC,kCAAAA,KAAC,SAAM,WAAW,GAAG,IAAI,EAAE,UAAU,YAEnC,UAAA;AAAA,IAAAA,kCAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI;AAAA,UACF,GAAG;AAAA,UACH,SAAS,CAAC,UAAW,MAAM,QAAQ,SAAS,SAAS,aAAa;AAAA,QAAA;AAAA,QAGpE,UAAA;AAAA,UAAAA,kCAAAA,KAAC,KAAA,EAAI,IAAI,EAAE,SAAS,QAAQ,gBAAgB,iBAAiB,YAAY,SAAA,GACvE,UAAA;AAAA,YAAAA,kCAAAA,KAAC,YAAA,EAAW,SAAQ,aAAY,YAAW,QAAO,UAAA;AAAA,cAAA;AAAA,cAC5C,MAAM;AAAA,YAAA,GACZ;AAAA,YACAD,kCAAAA;AAAAA,cAAC;AAAA,cAAA;AAAA,gBACC,OAAO,GAAG,MAAM,WAAW,MAAM;AAAA,gBACjC,MAAK;AAAA,gBACL,OAAM;AAAA,cAAA;AAAA,YAAA;AAAA,UAER,GACF;AAAA,UACAC,kCAAAA,KAAC,OAAA,EAAM,WAAU,OAAM,SAAS,GAAG,IAAI,EAAE,IAAI,EAAA,GAC3C,UAAA;AAAA,YAAAA,kCAAAA,KAAC,YAAA,EAAW,SAAQ,SAAQ,OAAM,kBAAiB,UAAA;AAAA,cAAA;AAAA,cAC3CD,kCAAAA,IAAC,UAAA,EAAQ,UAAA,eAAe,MAAM,aAAa,EAAA,CAAE;AAAA,YAAA,GACrD;AAAA,YACAC,kCAAAA,KAAC,YAAA,EAAW,SAAQ,SAAQ,OAAM,kBAAiB,UAAA;AAAA,cAAA;AAAA,cAC5CD,kCAAAA,IAAC,YAAQ,UAAA,aAAA,CAAa;AAAA,YAAA,EAAA,CAC7B;AAAA,UAAA,EAAA,CACF;AAAA,QAAA;AAAA,MAAA;AAAA,IAAA;AAAA,0CAGD,SAAA,EAAQ;AAAA,0CAGR,OAAA,EAAM,+CAAU,SAAA,EAAQ,GACtB,gBAAM,WAAW,IAAI,CAAC,oDACpB,eAAA,EAAiC,WAAsB,YAApC,UAAU,EAA8C,CAC7E,EAAA,CACH;AAAA,EAAA,GACF;AAEJ;AAEA,SAAS,cAAc;AAAA,EACrB;AAAA,EACA;AACF,GAGG;AACD,QAAM,OAAO,UAAU;AACvB,QAAM,gBAAgB,IAAI,KAAK,UAAU,YAAY;AACrD,QAAM,UAAU,cAAc,mBAAmB,SAAS;AAAA,IACxD,MAAM;AAAA,IACN,QAAQ;AAAA,EAAA,CACT;AAED,WAAS,aAAa,GAAqB;AACzC,MAAE,eAAA;AACF,MAAE,gBAAA;AACF,aAAS,UAAU,EAAE;AAAA,EACvB;AAEA,SACEC,kCAAAA;AAAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAW;AAAA,MACX,IAAI,OAAO,WAAW,OAAO,MAAM,EAAE,IAAI,UAAU,GAAA,GAAM,EAAE;AAAA,MAC3D,IAAI;AAAA,QACF,SAAS;AAAA,QACT,YAAY;AAAA,QACZ,gBAAgB;AAAA,QAChB,GAAG;AAAA,QACH,gBAAgB;AAAA,QAChB,OAAO;AAAA,QACP,WAAW;AAAA,UACT,SAAS,CAAC,UAAW,MAAM,QAAQ,SAAS,SAAS,aAAa;AAAA,QAAA;AAAA,MACpE;AAAA,MAGF,UAAA;AAAA,QAAAA,uCAAC,KAAA,EACC,UAAA;AAAA,UAAAD,sCAAC,cAAW,SAAQ,SAAQ,YAAW,UACpC,eAAK,MACR;AAAA,UACAC,kCAAAA,KAAC,YAAA,EAAW,SAAQ,WAAU,OAAM,kBACjC,UAAA;AAAA,YAAA;AAAA,YAAQ;AAAA,YAAI,eAAe,UAAU,gBAAgB;AAAA,UAAA,EAAA,CACxD;AAAA,QAAA,GACF;AAAA,+CACC,OAAA,EAAM,WAAU,OAAM,SAAS,GAAG,YAAW,UAC5C,UAAA;AAAA,UAAAD,kCAAAA;AAAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAO,GAAG,UAAU,UAAU,IAAI,WAAW,KAAK,SAAS,CAAC;AAAA,cAC5D,MAAK;AAAA,cACL,OAAM;AAAA,YAAA;AAAA,UAAA;AAAA,UAERA,kCAAAA;AAAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAK;AAAA,cACL,SAAS;AAAA,cACT,IAAI;AAAA,gBACF,OAAO;AAAA,gBACP,WAAW,EAAE,OAAO,aAAA;AAAA,cAAa;AAAA,cAGnC,UAAAA,kCAAAA,IAAC,YAAA,EAAW,UAAS,QAAA,CAAQ;AAAA,YAAA;AAAA,UAAA;AAAA,QAC/B,EAAA,CACF;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;"}