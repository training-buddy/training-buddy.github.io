{"version":3,"file":"learningHistories-CvuHvNjP.js","sources":["../../src/api/learningHistories.ts"],"sourcesContent":["import { supabase } from '../lib/supabase'\n\nexport type LearningHistoryInsert = {\n  owner: string\n  repo: string\n  path: string\n  sha: string\n  line_no: number\n  type: 'pass' | 'fail' | 'fin'\n  duration: number\n}\n\nexport type LearningHistoryRow = LearningHistoryInsert & {\n  id: number\n  user_id: string\n  created_at: string\n}\n\nexport async function addLearningHistories(items: LearningHistoryInsert[]): Promise<void> {\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n  if (!user) throw new Error('Not authenticated')\n\n  const rows = items.map((item) => ({\n    ...item,\n    user_id: user.id,\n  }))\n\n  const { error } = await supabase.from('learning_histories').insert(rows)\n  if (error) throw error\n}\n\nexport async function getLearningHistoriesBySha(sha: string): Promise<LearningHistoryRow[]> {\n  const { data, error } = await supabase\n    .from('learning_histories')\n    .select('*')\n    .eq('sha', sha)\n    .order('created_at', { ascending: true })\n\n  if (error) throw error\n  return data ?? []\n}\n\nexport async function getLearningHistoriesByDirectory(\n  owner: string,\n  repo: string,\n  path?: string\n): Promise<LearningHistoryRow[]> {\n  let query = supabase\n    .from('learning_histories')\n    .select('*')\n    .eq('owner', owner)\n    .eq('repo', repo)\n    .eq('type', 'fin')\n    .order('created_at', { ascending: true })\n\n  if (path) {\n    query = query.like('path', `${path}%`)\n  }\n\n  const { data, error } = await query\n  if (error) throw error\n  return data ?? []\n}\n\nexport async function getAllLearningHistories(): Promise<LearningHistoryRow[]> {\n  const { data, error } = await supabase\n    .from('learning_histories')\n    .select('*')\n    .order('created_at', { ascending: false })\n\n  if (error) throw error\n  return data ?? []\n}\n"],"names":[],"mappings":";AAkBA,eAAsB,qBAAqB,OAA+C;AACxF,QAAM;AAAA,IACJ,MAAM,EAAE,KAAA;AAAA,EAAK,IACX,MAAM,SAAS,KAAK,QAAA;AACxB,MAAI,CAAC,KAAM,OAAM,IAAI,MAAM,mBAAmB;AAE9C,QAAM,OAAO,MAAM,IAAI,CAAC,UAAU;AAAA,IAChC,GAAG;AAAA,IACH,SAAS,KAAK;AAAA,EAAA,EACd;AAEF,QAAM,EAAE,UAAU,MAAM,SAAS,KAAK,oBAAoB,EAAE,OAAO,IAAI;AACvE,MAAI,MAAO,OAAM;AACnB;AAEA,eAAsB,0BAA0B,KAA4C;AAC1F,QAAM,EAAE,MAAM,UAAU,MAAM,SAC3B,KAAK,oBAAoB,EACzB,OAAO,GAAG,EACV,GAAG,OAAO,GAAG,EACb,MAAM,cAAc,EAAE,WAAW,MAAM;AAE1C,MAAI,MAAO,OAAM;AACjB,SAAO,QAAQ,CAAA;AACjB;AAEA,eAAsB,gCACpB,OACA,MACA,MAC+B;AAC/B,MAAI,QAAQ,SACT,KAAK,oBAAoB,EACzB,OAAO,GAAG,EACV,GAAG,SAAS,KAAK,EACjB,GAAG,QAAQ,IAAI,EACf,GAAG,QAAQ,KAAK,EAChB,MAAM,cAAc,EAAE,WAAW,KAAA,CAAM;AAE1C,MAAI,MAAM;AACR,YAAQ,MAAM,KAAK,QAAQ,GAAG,IAAI,GAAG;AAAA,EACvC;AAEA,QAAM,EAAE,MAAM,MAAA,IAAU,MAAM;AAC9B,MAAI,MAAO,OAAM;AACjB,SAAO,QAAQ,CAAA;AACjB;AAEA,eAAsB,0BAAyD;AAC7E,QAAM,EAAE,MAAM,MAAA,IAAU,MAAM,SAC3B,KAAK,oBAAoB,EACzB,OAAO,GAAG,EACV,MAAM,cAAc,EAAE,WAAW,OAAO;AAE3C,MAAI,MAAO,OAAM;AACjB,SAAO,QAAQ,CAAA;AACjB;"}